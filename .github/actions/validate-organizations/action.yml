name: 'Validate Organization YAML Files'
description: 'Validates organization YAML files for conflicts and schema compliance'
inputs:
  files:
    description: 'Space-separated list of organization YAML files to validate'
    required: true
  organizations-dir:
    description: 'Directory containing organization YAML files'
    required: false
    default: 'organizations'
  slug-field:
    description: 'YAML field name for organization slug'
    required: false
    default: 'adres'

runs:
  using: 'composite'
  steps:
    - name: Install uv
      uses: astral-sh/setup-uv@v3
      with:
        version: "0.4.18"
    
    - name: Set up Python
      run: uv python install 3.11
      shell: bash
    
    - name: Install dependencies
      shell: bash
      run: |
        cd ${{ github.action_path }}
        uv sync --frozen
    
    - name: Validate organizations
      shell: bash
      run: |
        echo "Current directory: $(pwd)"
        echo "Files to check: ${{ inputs.files }}"
        echo "Organizations dir: ${{ inputs.organizations-dir }}"
        ls -la organizations/ || echo "organizations directory not found"
        
        # Convert relative paths to absolute paths from current working directory
        REPO_ROOT="$(pwd)"
        FILES_ABSOLUTE=""
        for file in ${{ inputs.files }}; do
          FILES_ABSOLUTE="$FILES_ABSOLUTE $REPO_ROOT/$file"
        done
        
        cd ${{ github.action_path }}
        uv run python validate.py \
          --files "$FILES_ABSOLUTE" \
          --organizations-dir "$REPO_ROOT/${{ inputs.organizations-dir }}" \
          --slug-field "${{ inputs.slug-field }}"
